<!--suppress HtmlFormInputWithoutLabel -->
<html>
    <head>
        <!--<script type="text/javascript" src="jquery.js"></script>-->
        <link rel="stylesheet" href="css/jquery-ui-1.10.0.custom.css" />
        <script src="jquery/jquery-1.9.0.js"></script>
        <script src="jquery/jquery-ui-1.10.0.custom.js"></script>
        <script type="text/javascript" src="js-gen/set.js"></script>
        <script type="text/javascript" src="js-gen/point.js"></script>
        <script type="text/javascript" src="js-gen/directions.js"></script>
        <script type="text/javascript" src="js-gen/grid.js"></script>
        <script type="text/javascript">
            function startGrid(){
                var c = $('#canvas')[0];
                var area = $('#drawArea')[0];

                c.width = area.clientWidth - 16;
                c.height = area.clientHeight - 56;
                c.style.width = c.width + 'px';
                c.style.height = c.height + 'px';

                window.grid = new Grid(c);
            }

            function go(){
                var opts = {
                    strokeStyle: $('#fade')[0].checked ? 'fade' : 'white',
                    cellSize: 10,
                    directionStyle: $('#directionStyle').val(),
                    directionArg: $('#arg').val(),
                    branchStyle: $('#branchStyle').val(),
                    weight: Math.abs(parseFloat($('#weight').val()) - 1),
                    branchTtl: $('#branchTtl').val(),
                    speed: 0,
                    onDone: function() { $('#go').val('Done'); }
                };

                var finishStyle = $('#finishStyle').val();
                if (finishStyle == 'percent')
                    opts['fillPercent'] = $('#fillPercent').val() / 100;
                else
                    opts['maxBranchCount'] = $('#maxBranchCount').val();

                window.grid.draw(opts);
            }

            function clickGo(){
                var controls = $("#controls");
                if (controls.is(":hidden")) {
                    window.grid.finish = true;
                    controls.slideDown("slow");
                    $('#go').val('Go');
                } else {
                    controls.slideUp('slow');
                    $('#go').val('Stop');
                    go();
                }
            }

            var argNames = {
                favorDirection: 'Direction',
                inertia: 'Mutation rate',
                x: 'Width',
                bounce: 'Start direction'
            };

            function onSelectDir(){
                var name = argNames[$('#directionStyle').val()];
                if (name){
                    $('#argSection').show();
                    $('#argName').html(name + ":");
                }
                else {
                    $('#argSection').hide();
                }
            }

            function onSelectFinish(){
                var sel = $('#finishStyle')[0];
                if (sel.selectedIndex == 0) {
                    $('#maxBranchCtrl').hide();
                    $('#fillPercentCtrl').show();
                }
                else {
                    $('#fillPercentCtrl').hide();
                    $('#maxBranchCtrl').show();
                }
            }

            $(function(){
                $('#directionStyle').change(onSelectDir);
                $('#finishStyle').change(onSelectFinish);
                $('#argSlide').slider({
                    min: 5,
                    max: 100,
                    value: 100,
                    step: 1,
                    slide: function(event, ui) {
                        $("#maxBranchCount").val(ui.value);
                    }
                });
                $('#maxBranchSlide').slider({
                    min: 5,
                    max: 1000,
                    value: 100,
                    step: 1,
                    slide: function(event, ui) {
                        $("#maxBranchCount").val(ui.value);
                    }
                });
                $('#branchTtlSlide').slider({
                    min: 1,
                    max: 5,
                    value: 2,
                    step: 0.1,
                    slide: function(event, ui) {
                        $("#branchTtl").val(Math.floor(Math.pow(10, ui.value)));
                    }
                });
                $('#weightSlide').slider({
                    min: 0,
                    max: 0.5,
                    value: 0.1,
                    step: 0.01,
                    slide: function(event, ui) {
                        $("#weight").val(ui.value);
                    }
                });
                $('#fillPercentSlide').slider({
                    min: 0,
                    max: 1,
                    value: 1,
                    step: 0.01,
                    slide: function(event, ui) {
                        $("#fillPercent").val(parseInt(ui.value * 100));
                    }
                });
                $('#go').click(clickGo);
                onSelectDir();
                onSelectFinish();
                startGrid();
            });
        </script>
        <style>
            body { background:black;color:white;overflow:hidden;font-family:arial,sans-serif;font-size:0.8em }
            .control input, .control select { background:black;color:white }
            /*.control select { width: 100%; }*/
            .slider { display: inline-block; margin-top:5px; margin-left:20px; margin-right:20px; width: 150px; }
            .container { display:inline-block; vertical-align:top; }
        </style>
    </head>
    <body>
    <div id="controls" style="position:absolute;top:0;margin-left:20px">
        <div class="container">
            <div class="control">
                <select id="directionStyle" class="control">
                    <option value="random">Wander at random</option>
                    <option value="favorDirection">Favor direction</option>
                    <option value="trendToCenter">Trend to center</option>
                    <option value="x">Form an X</option>
                    <option value="explode">Explode</option>
                    <option value="jagged">Go jaggedly</option>
                    <option value="squarish">Go squarishly</option>
                    <option value="inertia">Use inertia</option>
                    <option value="bounce">Bounce</option>
                </select>
                <select id="branchStyle">
                    <option value="random">Branch at random</option>
                    <option value="fromStart">Branch from start</option>
                    <option value="fromEnd">Branch from end</option>
                </select>
            </div>
        </div>
        <div class="container">
            <div class="control">
                <select id="finishStyle">
                    <option value="percent">Fill percent:</option>
                    <option value="branch">Draw branches:</option>
                </select>
                <div class="control" id="fillPercentCtrl">
                    <div class="slider">
                        <div id="fillPercentSlide"></div>
                    </div>
                    <input type="text" id="fillPercent" value="100" size="4"/>
                </div>
                <div class="control" id="maxBranchCtrl">
                    <div class="slider">
                        <div id="maxBranchSlide"></div>
                    </div>
                    <input type="text" id="maxBranchCount" value="100" size="4"/>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="control">
                Randomization:<br/>
                <div class="slider">
                    <div id="weightSlide"></div>
                </div>
                <input type="text" id="weight" value="0.1" size="4"/>
            </div>
            <div class="control">
                Max branch length:<br/>
                <div class="slider">
                    <div id="branchTtlSlide"></div>
                </div>
                <input type="text" id="branchTtl" value="100" size="4"/>
            </div>
            <div id="argSection" class="control">
                <span id="argName">Argument:</span>
                <div class="slider">
                    <div id="argSlide"></div>
                </div>
                <input type="text" id="arg" value="" size="4"/>
            </div>
        </div>

        <div class="container">
            <div class="control">
                <input type="checkbox" id="fade" /> Fade out
            </div>
        </div>

    </div>

    <div class="container" style="position:absolute;top:0;right:0">
        <input type="button" id="go" value="Go!" />
    </div>

    <div id="drawArea" style="width:100%;height:100%">
        <canvas id="canvas"></canvas>
    </div>

    </body>
</html>
